#!/usr/bin/env python3
import sys
import os

# Add the repository root to sys.path
repo_root = os.path.abspath(os.path.join(os.path.dirname(__file__), '..'))
if repo_root not in sys.path:
    sys.path.insert(0, repo_root)

def main():
    if len(sys.argv) < 2:
        print("Usage: repack <script.py> [args...]")
        sys.exit(1)

    script_path = sys.argv[1]

    # Remove 'repack' from argv, so the script sees itself as the first arg
    sys.argv = sys.argv[1:]

    if not os.path.exists(script_path):
        print(f"Error: Script '{script_path}' not found.")
        sys.exit(1)

    try:
        with open(script_path) as f:
            code = compile(f.read(), script_path, 'exec')

        # Execute the script in a global namespace
        # We set __name__ to __main__ so the script thinks it's being run directly
        global_vars = {
            '__name__': '__main__',
            '__file__': script_path,
            '__doc__': None,
            '__package__': None
        }
        exec(code, global_vars)
    except Exception as e:
        import traceback
        traceback.print_exc()
        sys.exit(1)

if __name__ == "__main__":
    main()
